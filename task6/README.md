### <a name="_b7urdng99y53"></a>**Название задачи:** Проектирование fitness-функций
### <a name="_hjk0fkfyohdk"></a>**Автор:** Гуреев Евгений
### <a name="_uanumrh8zrui"></a>**Дата:** январь 2026

---



## Fitness-функции для обеспечения качества работы платёжной системы

### Основные функции для контроля критичных аспектов

 | Название функции | Назначение | Что проверяется | Действие при нарушении | Способ реализации |
 |------------------|------------|-----------------|------------------------|-------------------|
 | MoneyFlowIntegrity | Не допускать зависания денег в системе | Деньги не должны застревать между сервисами | Автоматический возврат средств | Периодическая проверка состояния платежей |
 | PaymentTimeoutControl | Следить за временем обработки платежей | Платежи не должны обрабатываться слишком долго | Завершение с возвратом или уведомлением | Мониторинг времени выполнения |
 | SagaConsistencyCheck | Проверять целостность длинных транзакций | Все этапы Saga должны быть согласованы | Попытка восстановления или отката | Проверка состояний в разных сервисах |
 | ManualReviewDeadline | Контролировать время ручных проверок | Ручные проверки не должны превышать 20 минут | Автоматическое принятие решения | Таймеры и мониторинг времени |
 | NotificationCompleteness | Проверять отправку уведомлений | Все важные события должны уведомляться | Повторная отправка уведомлений | Логирование и проверка отправок |

### Дополнительные функции для улучшения надёжности

 | Название функции | Назначение | Что проверяется | Действие при нарушении | Способ реализации |
 |------------------|------------|-----------------|------------------------|-------------------|
 | RetryLimitControl | Ограничивать количество повторных попыток | Число повторов не должно быть бесконечным | Прекращение повторных попыток | Счётчики повторных вызовов |
 | ExternalServiceHealth | Мониторить внешние сервисы | Внешние системы должны быть доступны | Переключение на запасные варианты | Проверки доступности сервисов |
 | DataConsistency | Следить за согласованностью данных | Данные в разных сервисах должны совпадать | Синхронизация данных | Периодическая сверка данных |
 | SecurityAlertCheck | Проверять оповещения безопасности | Подозрительные операции должны фиксироваться | Уведомление службы безопасности | Анализ журналов операций |
 | ProcessStuckDetection | Находить зависшие процессы | Процессы не должны зависать надолго | Перезапуск или восстановление | Мониторинг активности процессов |
 | Самые важные функции (для начала) |

## Из всех функций самыми критичными являются:

- `MoneyFlowIntegrity` — самая важная, чтобы деньги не терялись
- `PaymentTimeoutControl` — чтобы не было долгих ожиданий
- `SagaConsistencyCheck` — чтобы транзакции завершались корректно

Эти три функции покрывают основные риски:
- Финансовые потери
- Нарушение SLA
- Некорректное завершение операций

Остальные функции можно добавлять постепенно, по мере развития системы и выявления новых проблем.

