### <a name="_b7urdng99y53"></a>**Название задачи:** Добиваемся качества реализации
### <a name="_hjk0fkfyohdk"></a>**Автор:** Гуреев Евгений
### <a name="_uanumrh8zrui"></a>**Дата:** январь 2026

---



## Критические бизнес-сценарии (E2E)

- Успешный платёж - основной сценарий, должен работать всегда
- Отказ антифрода - самая частая компенсация
- Ручная проверка с таймаутом - сложный сценарий с cut-off
- Сбой перевода - проверка 2й опорной точки

---



## Набор минимальных тестов самых критичных мест

| Название | Тип | Что проверяет | Критичность |
|----------|-----|---------------|-------------|
| 1. Успешный платёж | E2E | Весь основной поток | Высокая |
| 2. Отказ антифрода → возврат | E2E | Компенсационный путь | Высокая |
| 3. Идемпотентность платежа | Integration | Защита от дублей | Высокая |
| 4. Возврат при сбое перевода | E2E | Pivot point логика | Высокая |
| 5. Восстановление после сбоя | E2E | Отказоустойчивость | Средняя |

---



## Набор основных интеграционных и E2E тестов OrchestrPay

| Название | Тип | Компоненты | Предусловия |
|----------|-----|------------|-------------|
| 1. Успешный платёж | E2E | Payment Service, FraudCheck Service, Camunda | антифрод одобряет, перевод успешен |
| 2. Отказ антифрода с автоматическим возвратом | E2E | Payment Service, FraudCheck Service, Refund Service | антифрод отклоняет, перевод успешен |
| 3. Ручная проверка с автоодобрением по таймауту | E2E | Payment Service, FraudCheck Service, Camunda Timer | антифрод с ручной проверкой, таймаут 20 мин |
| 4. Сбой перевода контрагенту → возврат | E2E | Payment Service, FraudCheck Service, Refund Service | антифрод одобряет, перевод не успешен |
| 5. Идемпотентность: повторный запрос не создаёт дубли | Integration | Payment API, Payment Service DB | Дублирующий paymentId |
| 6. Гарантия "деньги не зависают": возврат при любом отказе после списания | E2E | Payment Service, FraudCheck Service, Refund Service | успешное списание средств, затем любой отказ |
| 7. SLA: время выполнения <5 секунд | Performance | Все сервисы | Нагрузочное тестирование успешного сценария |
| 8. Восстановление после сбоя оркестратора | E2E | Camunda, Payment Service | Падение в середине процесса |
| 9. State Machine: корректные переходы статусов | Integration | Payment Service | Проверка всех переходов |
| 10. Уведомления клиента отправляются | Integration | Notification Service | Финальные статусы: COMPLETED, REFUNDED |
